openapi: 3.0.3
info:
  title: CringeBoard API
  version: "1.0.0"
  description: >
    Swagger / OpenAPI description generated from the current FastAPI routes
    (snapshot 2026-01-28). Bearer auth tokens are required on protected
    endpoints; supply `Authorization: Bearer <access_token>`.
servers:
  - url: http://localhost:8000
security:
  - bearerAuth: []

paths:
  /:
    get:
      tags: [system]
      summary: Root
      responses:
        "200":
          description: Service info
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                  status:
                    type: string
  /healthz:
    get:
      tags: [system]
      summary: Liveness probe
      responses:
        "200":
          description: Service health

  /v1/auth/register:
    post:
      tags: [auth]
      summary: Register user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: Tokens issued
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
  /v1/auth/login:
    post:
      tags: [auth]
      summary: Login with email/password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Tokens issued
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
  /v1/auth/refresh:
    post:
      tags: [auth]
      summary: Refresh tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshRequest"
      responses:
        "200":
          description: Tokens refreshed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
  /v1/auth/users/me:
    get:
      tags: [auth]
      summary: Get current user
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: Current user profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  email: { type: string, format: email }
                  id: { type: integer }
    delete:
      tags: [auth]
      summary: Delete current user
      security: [{ bearerAuth: [] }]
      responses:
        "204":
          description: User removed
  /v1/auth/users/me/preferences:
    get:
      tags: [auth]
      summary: Get user preferences
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: Preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Preferences"
    put:
      tags: [auth]
      summary: Update user preferences
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PreferencesUpdate"
      responses:
        "200":
          description: Updated preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Preferences"
  /v1/auth/users/me/preferences/hide-source:
    post:
      tags: [auth]
      summary: Hide a source
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SourceToggleRequest"
      responses:
        "200":
          description: Updated preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Preferences"
  /v1/auth/users/me/preferences/hide-source/{source_id}:
    delete:
      tags: [auth]
      summary: Unhide a source
      security: [{ bearerAuth: [] }]
      parameters:
        - name: source_id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: Updated preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Preferences"

  /v1/newspapers:
    get:
      tags: [newspapers]
      summary: List newspapers
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: owner_email
          schema: { type: string, format: email }
      responses:
        "200":
          description: Newspapers
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Newspaper" }
    post:
      tags: [newspapers]
      summary: Create newspaper
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/NewspaperCreate" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Newspaper" }
  /v1/newspapers/{newspaper_id}:
    get:
      tags: [newspapers]
      summary: Get newspaper
      parameters:
        - $ref: "#/components/parameters/NewspaperId"
      responses:
        "200":
          description: Newspaper detail
          content:
            application/json:
              schema: { $ref: "#/components/schemas/NewspaperDetail" }
    patch:
      tags: [newspapers]
      summary: Update newspaper
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/NewspaperId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/NewspaperUpdate" }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Newspaper" }
    delete:
      tags: [newspapers]
      summary: Delete newspaper
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/NewspaperId"
      responses:
        "204":
          description: Deleted
  /v1/newspapers/{newspaper_id}/articles:
    get:
      tags: [newspapers]
      summary: List articles in newspaper
      parameters:
        - $ref: "#/components/parameters/NewspaperId"
        - in: query
          name: q
          schema: { type: string }
      responses:
        "200":
          description: Articles
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Article" }
    post:
      tags: [newspapers]
      summary: Create article in newspaper
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/NewspaperId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ArticleCreate" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
  /v1/newspapers/{newspaper_id}/articles/{article_id}:
    post:
      tags: [newspapers]
      summary: Attach existing article
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/NewspaperId"
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "200":
          description: Article attached
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
    delete:
      tags: [newspapers]
      summary: Detach article
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/NewspaperId"
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "200":
          description: Article detached
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
  /v1/newspapers/{newspaper_id}/share:
    post:
      tags: [newspapers]
      summary: Toggle public sharing
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/NewspaperId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/NewspaperShareRequest" }
      responses:
        "200":
          description: Updated newspaper
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Newspaper" }

  /v1/public/newspapers/{public_token}:
    get:
      tags: [public-newspapers]
      summary: Get public newspaper by token
      parameters:
        - name: public_token
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Public newspaper
          content:
            application/json:
              schema: { $ref: "#/components/schemas/NewspaperDetail" }

  /v1/articles:
    get:
      tags: [articles]
      summary: Search articles
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: owner_email
          schema: { type: string, format: email }
        - in: query
          name: newspaper_id
          schema: { type: integer, minimum: 1 }
      responses:
        "200":
          description: Articles
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Article" }
  /v1/articles/popular:
    get:
      tags: [articles]
      summary: Popular articles
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: owner_email
          schema: { type: string, format: email }
        - in: query
          name: newspaper_id
          schema: { type: integer, minimum: 1 }
      responses:
        "200":
          description: Articles
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Article" }
  /v1/articles/favorite:
    get:
      tags: [articles]
      summary: List my favorite articles
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: Favorites
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Article" }
  /v1/articles/{article_id}:
    get:
      tags: [articles]
      summary: Get article
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "200":
          description: Article
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
    patch:
      tags: [articles]
      summary: Update article
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ArticleUpdate" }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
    delete:
      tags: [articles]
      summary: Delete article
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "204":
          description: Deleted
  /v1/articles/{article_id}/related:
    get:
      tags: [articles]
      summary: List related articles
      parameters:
        - $ref: "#/components/parameters/ArticleId"
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        "200":
          description: Related articles
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Article" }
  /v1/articles/{article_id}/favorite:
    post:
      tags: [articles]
      summary: Favorite article
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "200":
          description: Favorited article
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
    delete:
      tags: [articles]
      summary: Unfavorite article
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "204":
          description: Unfavorited
  /v1/articles/{article_id}/read-later:
    post:
      tags: [articles]
      summary: Mark article for later
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "200":
          description: Saved
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
    delete:
      tags: [articles]
      summary: Remove read-later
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "204":
          description: Removed

  /v1/sources:
    get:
      tags: [sources]
      summary: List sources
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: status
          schema: { type: string }
        - in: query
          name: follower_email
          schema: { type: string, format: email }
      responses:
        "200":
          description: Sources
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Source" }
    post:
      tags: [sources]
      summary: Create source
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/SourceCreate" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Source" }
  /v1/sources/{source_id}:
    get:
      tags: [sources]
      summary: Get source
      parameters:
        - $ref: "#/components/parameters/SourceId"
      responses:
        "200":
          description: Source
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Source" }
    patch:
      tags: [sources]
      summary: Update source
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/SourceId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/SourceUpdate" }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Source" }
  /v1/sources/{source_id}/follow:
    post:
      tags: [sources]
      summary: Follow source
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/SourceId"
      responses:
        "200":
          description: Followed
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Source" }
    delete:
      tags: [sources]
      summary: Unfollow source
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/SourceId"
      responses:
        "204":
          description: Unfollowed

  /v1/me/favorites:
    get:
      tags: [me]
      summary: List my favorites
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: Articles
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Article" }
    post:
      tags: [me]
      summary: Add favorite
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ArticleAction" }
      responses:
        "201":
          description: Favorited
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
  /v1/me/favorites/{article_id}:
    delete:
      tags: [me]
      summary: Remove favorite
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "204":
          description: Removed
  /v1/me/read-later:
    get:
      tags: [me]
      summary: List read-later
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: Articles
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Article" }
    post:
      tags: [me]
      summary: Save for later
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ArticleAction" }
      responses:
        "201":
          description: Saved
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Article" }
  /v1/me/read-later/{article_id}:
    delete:
      tags: [me]
      summary: Remove read-later
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ArticleId"
      responses:
        "204":
          description: Removed
  /v1/me/sources:
    get:
      tags: [me]
      summary: List followed sources
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: Sources
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Source" }
  /v1/me/notifications:
    get:
      tags: [me]
      summary: List notifications
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: include_read
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Notifications
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Notification" }
  /v1/me/notifications/{notification_id}/read:
    post:
      tags: [me]
      summary: Mark notification read
      security: [{ bearerAuth: [] }]
      parameters:
        - name: notification_id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: Updated notification
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Notification" }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    NewspaperId:
      name: newspaper_id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
    ArticleId:
      name: article_id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
    SourceId:
      name: source_id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1

  schemas:
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
    RegisterRequest:
      type: object
      required: [email, password, confirm_password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        confirm_password:
          type: string
          minLength: 8
    RefreshRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string
    TokenResponse:
      type: object
      required: [access_token, refresh_token, token_type]
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          default: bearer
    Preferences:
      type: object
      properties:
        theme:
          type: string
          enum: [light, dark]
          default: light
        hidden_source_ids:
          type: array
          items: { type: integer, minimum: 1 }
          default: []
    PreferencesUpdate:
      type: object
      properties:
        theme:
          type: string
          enum: [light, dark]
        hidden_source_ids:
          type: array
          items: { type: integer, minimum: 1 }
    SourceToggleRequest:
      type: object
      required: [source_id]
      properties:
        source_id:
          type: integer
          minimum: 1
    NewspaperBase:
      type: object
      required: [title]
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          nullable: true
          maxLength: 2000
    NewspaperCreate:
      allOf:
        - $ref: "#/components/schemas/NewspaperBase"
        - type: object
          properties:
            source_id:
              type: integer
              minimum: 1
              nullable: true
    NewspaperUpdate:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          nullable: true
          maxLength: 2000
        source_id:
          type: integer
          minimum: 1
          nullable: true
    Newspaper:
      type: object
      properties:
        id: { type: integer }
        title: { type: string }
        description: { type: string, nullable: true }
        owner_id: { type: integer }
        is_public: { type: boolean }
        public_token: { type: string, nullable: true }
        public_url: { type: string, nullable: true }
        source_id: { type: integer, nullable: true }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
    NewspaperDetail:
      allOf:
        - $ref: "#/components/schemas/Newspaper"
        - type: object
          properties:
            articles:
              type: array
              items: { $ref: "#/components/schemas/Article" }
    NewspaperShareRequest:
      type: object
      required: [public]
      properties:
        public:
          type: boolean
    ArticleBase:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        content:
          type: string
          nullable: true
          maxLength: 20000
        url:
          type: string
          nullable: true
          maxLength: 2000
    ArticleCreate:
      allOf:
        - $ref: "#/components/schemas/ArticleBase"
      required: [title]
    ArticleUpdate:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        content:
          type: string
          nullable: true
          maxLength: 20000
        url:
          type: string
          nullable: true
          maxLength: 2000
    Article:
      type: object
      properties:
        id: { type: integer }
        title: { type: string }
        content: { type: string, nullable: true }
        url: { type: string, nullable: true }
        owner_id: { type: integer }
        popularity: { type: integer, default: 0 }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
        newspaper_ids:
          type: array
          items: { type: integer }
          default: []
    ArticleAction:
      type: object
      required: [article_id]
      properties:
        article_id:
          type: integer
          minimum: 1
    SourceBase:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        feed_url:
          type: string
          nullable: true
          maxLength: 2000
        description:
          type: string
          nullable: true
          maxLength: 2000
        status:
          type: string
          nullable: true
          maxLength: 50
    SourceCreate:
      allOf:
        - $ref: "#/components/schemas/SourceBase"
      required: [name]
    SourceUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        feed_url:
          type: string
          nullable: true
          maxLength: 2000
        description:
          type: string
          nullable: true
          maxLength: 2000
        status:
          type: string
          nullable: true
          maxLength: 50
    Source:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        feed_url: { type: string, nullable: true }
        description: { type: string, nullable: true }
        status: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
        is_followed: { type: boolean, default: false }
    Notification:
      type: object
      properties:
        id: { type: integer }
        user_id: { type: integer }
        source_id: { type: integer }
        article_id: { type: integer, nullable: true }
        newspaper_id: { type: integer, nullable: true }
        message: { type: string }
        is_read: { type: boolean, default: false }
        created_at: { type: string, format: date-time }
